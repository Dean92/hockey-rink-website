<div class="container mt-4">
  <h2 class="text-primary mb-4">Sessions</h2>

  @if (errorMessage()) {
  <div class="alert alert-danger">
    {{ errorMessage() }}
  </div>
  }

  <div class="card shadow mb-4">
    <div class="card-body">
      <h5 class="card-title">Filter Sessions</h5>
      <form [formGroup]="filterForm">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="leagueFilter" class="form-label"
              >Filter by League:</label
            >
            <select
              id="leagueFilter"
              formControlName="league"
              class="form-select"
            >
              <option value="">All Leagues</option>
              @for (league of leagues(); track league.id) {
              <option [value]="league.id">
                {{ league.name }} - {{ league.description }}
              </option>
              }
            </select>
          </div>
          <div class="col-md-6 mb-3">
            <label for="dateFilter" class="form-label">Filter by Date:</label>
            <input
              id="dateFilter"
              type="date"
              formControlName="date"
              class="form-control"
            />
          </div>
        </div>
      </form>
    </div>
  </div>

  @if (isLoading()) {
  <div class="text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
  } @else { @if (sessions().length) {
  <div class="row">
    @for (session of sessions(); track session.id) {
    <div class="col-md-6 mb-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">{{ session.name }}</h5>
          <p class="card-text">
            <strong>League:</strong> {{ session.league?.name || "N/A" }}<br />
            <strong>Start:</strong> {{ session.startDate | date : "medium"
            }}<br />
            <strong>End:</strong> {{ session.endDate | date : "medium" }}<br />

            @if (session.registrationOpenDate) {
            <strong>Registration Opens:</strong>
            {{ session.registrationOpenDate | date : "medium" }}<br />
            } @if (session.registrationCloseDate) {
            <strong>Registration Closes:</strong>
            {{ session.registrationCloseDate | date : "medium" }}<br />
            } @if (session.earlyBirdPrice && session.earlyBirdEndDate) {
            <strong>Early Bird Price:</strong> ${{ session.earlyBirdPrice }}
            <small class="text-muted"
              >(until {{ session.earlyBirdEndDate | date : "short" }})</small
            ><br />
            } @if (session.regularPrice) {
            <strong>Regular Price:</strong> ${{ session.regularPrice }}<br />
            } @else {
            <strong>Fee:</strong> ${{ session.fee }}<br />
            } @if (session.maxPlayers) {
            <strong>Max Players:</strong> {{ session.maxPlayers }}<br />
            }

            <strong>Status:</strong>
            <span
              [class]="
                session.isActive ? 'badge bg-success' : 'badge bg-secondary'
              "
            >
              {{ session.isActive ? "Active" : "Inactive" }}
            </span>
          </p>

          @if (session.isActive) {
          <a
            [routerLink]="['/session-registration']"
            [queryParams]="{ sessionId: session.id }"
            class="btn btn-primary"
          >
            Register for Session
          </a>
          } @else {
          <div class="alert alert-warning mb-0">
            <i class="bi bi-exclamation-triangle me-2"></i>
            This session is currently inactive and not accepting registrations.
          </div>
          }
        </div>
      </div>
    </div>
    }
  </div>
  } @else {
  <div class="alert alert-info">
    <p class="mb-0">No sessions found. Try adjusting your filters.</p>
  </div>
  } }
</div>
