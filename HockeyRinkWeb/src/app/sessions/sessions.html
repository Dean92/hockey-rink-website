<!-- Hero Section -->
<div class="sessions-hero text-white">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1 class="h2 fw-bold mb-2">
          <i class="bi bi-calendar-event me-2"></i>Available Sessions
        </h1>
        <p class="mb-0 opacity-90" style="font-size: 0.95rem">
          Register for upcoming sessions
        </p>
      </div>
    </div>
  </div>
</div>

<div class="container pb-5">
  <!-- Error Alert -->
  @if (errorMessage()) {
  <div
    class="alert alert-danger shadow-sm rounded-3 border-0 mb-4 d-flex align-items-center"
  >
    <i class="bi bi-exclamation-triangle-fill me-2 fs-4"></i>
    <div>{{ errorMessage() }}</div>
  </div>
  }

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="text-center py-5">
    <div
      class="spinner-border text-primary"
      role="status"
      style="width: 3rem; height: 3rem"
    >
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading sessions...</p>
  </div>
  } @else { @if (sessions().length) {
  <div class="row g-4 mt-4">
    @for (session of sessions(); track session.id) {
    <div class="col-lg-4 col-md-6">
      <div
        class="card session-card h-100 shadow-sm border-0"
        [class.preferred-league]="isUserPreferredLeague(session)"
      >
        <!-- Opening Soon Badge - Top of Card -->
        @if (isRegistrationOpeningSoon(session)) {
        <div class="card-header bg-info text-white border-0 py-2">
          <div class="d-flex align-items-center justify-content-center">
            <i class="bi bi-clock-fill me-2"></i>
            <span class="fw-semibold small"
              >Registration Opens
              {{ session.registrationOpenDate | date : "MMM d, y" }}</span
            >
          </div>
        </div>
        }

        <!-- Starting Soon Badge - Top of Card -->
        @if (isSessionStartingSoon(session)) {
        <div class="card-header bg-warning text-dark border-0 py-2">
          <div class="d-flex align-items-center justify-content-center">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <span class="fw-semibold small"
              >Starting Soon - Registration Closed</span
            >
          </div>
        </div>
        }

        <div class="session-card-header">
          <div class="session-league-badge">
            {{ session.league?.name || "Open Session" }}
            @if (isUserPreferredLeague(session)) {
            <i class="bi bi-star-fill ms-1" title="Your League"></i>
            }
          </div>
          <h5 class="session-card-title">{{ session.name }}</h5>
        </div>

        <div class="session-card-body">
          <!-- Dates -->
          <div class="info-item">
            <div class="info-icon"><i class="bi bi-calendar-event"></i></div>
            <div>
              <strong>Start:</strong>
              {{ session.startDate | date : "mediumDate" }}
            </div>
          </div>
          <div class="info-item">
            <div class="info-icon"><i class="bi bi-calendar-check"></i></div>
            <div>
              <strong>End:</strong> {{ session.endDate | date : "mediumDate" }}
            </div>
          </div>

          <!-- Registration Dates -->
          @if (session.registrationOpenDate) {
          <div class="info-item">
            <div class="info-icon"><i class="bi bi-door-open"></i></div>
            <div>
              <span class="d-block text-muted small">Registration Opens</span>
              {{ session.registrationOpenDate | date : "mediumDate" }}
            </div>
          </div>
          } @if (session.registrationCloseDate) {
          <div class="info-item">
            <div class="info-icon"><i class="bi bi-door-closed"></i></div>
            <div>
              <span class="d-block text-muted small">Registration Closes</span>
              {{ session.registrationCloseDate | date : "mediumDate" }}
            </div>
          </div>
          }

          <!-- Capacity -->
          @if (session.maxPlayers) {
          <div class="info-item mt-3">
            <div class="info-icon"><i class="bi bi-people"></i></div>
            <div class="w-100">
              <div class="d-flex justify-content-between mb-1">
                <span>Capacity</span>
                <span class="fw-bold"
                  >{{ session.registrationCount || 0 }}/{{
                    session.maxPlayers
                  }}</span
                >
              </div>
              <div class="progress" style="height: 6px">
                <div
                  class="progress-bar"
                  role="progressbar"
                  [style.width.%]="
                    ((session.registrationCount || 0) / session.maxPlayers) *
                    100
                  "
                  [class.bg-success]="
                    (session.registrationCount || 0) / session.maxPlayers < 0.8
                  "
                  [class.bg-warning]="
                    (session.registrationCount || 0) / session.maxPlayers >=
                      0.8 &&
                    (session.registrationCount || 0) / session.maxPlayers < 1
                  "
                  [class.bg-danger]="
                    (session.registrationCount || 0) / session.maxPlayers >= 1
                  "
                ></div>
              </div>
            </div>
          </div>
          }

          <!-- Status Badge (Active/Inactive) -->
          <div class="info-item mt-3">
            <div class="info-icon"><i class="bi bi-info-circle"></i></div>
            <div>
              <strong>Status: </strong>
              <span
                [class]="
                  session.isActive ? 'badge bg-success' : 'badge bg-secondary'
                "
              >
                {{ session.isActive ? "Active" : "Inactive" }}
              </span>
            </div>
          </div>
        </div>

        <div class="session-card-footer d-block">
          @if (isRegistrationOpen(session)) {
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="price-display">
              @if (isEarlyBirdActive(session)) {
              <span class="price-label text-success">Early Bird</span>
              <span class="price-value text-success"
                >${{ session.earlyBirdPrice }}</span
              >
              <small
                class="text-muted"
                style="font-size: 0.7rem; display: block"
                >Ends
                {{
                  session.earlyBirdEndDate | date : "MMM d, y 'at' h:mm a"
                }}</small
              >
              @if (session.regularPrice) {
              <small
                class="text-muted fw-bold"
                style="font-size: 0.85rem; display: block; margin-top: 0.25rem"
                >Regular Price: ${{ session.regularPrice }}</small
              >
              } } @else if (session.regularPrice) {
              <span class="price-label">Price</span>
              <span class="price-value">${{ session.regularPrice }}</span>
              } @else {
              <span class="price-label">Fee</span>
              <span class="price-value">${{ session.fee }}</span>
              }
            </div>

            @if (session.spotsLeft !== undefined && session.spotsLeft > 0) {
            <span
              [class]="
                session.spotsLeft <= 5
                  ? 'badge bg-warning text-dark spots-badge'
                  : 'badge bg-success spots-badge'
              "
            >
              @if (session.spotsLeft <= 5) { {{ session.spotsLeft }} Left! }
              @else { Open }
            </span>
            }
          </div>
          }

          <!-- Action Buttons -->
          <div class="d-grid">
            @if (session.isActive && !session.isFull) {
            <a
              [routerLink]="['/session-registration']"
              [queryParams]="{ sessionId: session.id }"
              class="btn btn-primary fw-bold"
            >
              Register Now
            </a>
            } @else if (session.isFull) {
            <button class="btn btn-secondary" disabled>Session Full</button>
            } @else {
            <button class="btn btn-outline-secondary" disabled>
              Registration Closed
            </button>
            }
          </div>
        </div>
      </div>
    </div>
    }
  </div>
  } @else {
  <div class="text-center py-5 text-muted">
    <i class="bi bi-calendar-x display-1 mb-3 d-block opacity-25"></i>
    <h4>No sessions found</h4>
    <p>Try adjusting your filters to see more results.</p>
  </div>
  } }
</div>
