<div class="container mt-5">
  <div class="mb-4">
    <h2 class="text-primary"><i class="bi bi-people"></i> User Management</h2>
  </div>

  @if (isLoading()) {
  <div class="text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
  } @if (errorMessage()) {
  <div class="alert alert-danger" role="alert">
    {{ errorMessage() }}
  </div>
  } @if (!isLoading() && users().length > 0) {
  <div class="card shadow">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <p class="text-muted mb-0">
          <i class="bi bi-info-circle"></i> Click on a user to view and edit
          their profile, rating, and notes
        </p>
        <div class="input-group" style="max-width: 300px">
          <span class="input-group-text" id="search-icon">
            <i class="bi bi-search"></i>
          </span>
          <input
            type="text"
            class="form-control"
            placeholder="Search by name..."
            [(ngModel)]="searchTerm"
            aria-label="Search users"
            aria-describedby="search-icon"
          />
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Position</th>
              <th>League</th>
              <th>Player Rating</th>
              <th>Email Confirmed</th>
              <th>Created At</th>
              <th>Last Login</th>
            </tr>
          </thead>
          <tbody>
            @for (user of paginatedUsers(); track user.id) {
            <tr
              (click)="viewUserProfile(user.id)"
              style="cursor: pointer"
              class="user-row"
            >
              <td>{{ user.firstName }} {{ user.lastName }}</td>
              <td>{{ user.email }}</td>
              <td>
                @if (user.position) {
                <span class="badge bg-info">{{ user.position }}</span>
                } @else {
                <span class="text-muted">Not set</span>
                }
              </td>
              <td>
                @if (user.leagueName) {
                <span class="badge bg-secondary">{{ user.leagueName }}</span>
                } @else {
                <span class="text-muted">Not assigned</span>
                }
              </td>
              <td>
                @if (user.rating) {
                <span class="badge bg-warning">
                  <i class="bi bi-star-fill"></i> {{ user.rating }}
                </span>
                } @else {
                <span class="text-muted">Not rated</span>
                }
              </td>
              <td>
                @if (user.emailConfirmed) {
                <span class="badge bg-success">âœ“ Confirmed</span>
                } @else {
                <span class="badge bg-warning">Pending</span>
                }
              </td>
              <td>{{ formatDateInCentralTime(user.createdAt) }}</td>
              <td>
                @if (user.lastLoginAt) {
                <span>{{ formatDateInCentralTime(user.lastLoginAt) }}</span>
                } @else {
                <span class="text-muted">Never</span>
                }
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Pagination Controls -->
      @if (totalPages() > 1) {
      <div class="d-flex justify-content-between align-items-center mt-3">
        <div class="text-muted">
          Showing {{ (currentPage() - 1) * pageSize + 1 }} to
          {{ Math.min(currentPage() * pageSize, filteredUsers().length) }}
          of {{ filteredUsers().length }} users
        </div>
        <nav aria-label="User pagination">
          <ul class="pagination mb-0">
            <li class="page-item" [class.disabled]="currentPage() === 1">
              <button
                class="page-link"
                (click)="previousPage()"
                [disabled]="currentPage() === 1"
              >
                Previous
              </button>
            </li>
            @for (page of [].constructor(totalPages()); track $index) {
            <li class="page-item" [class.active]="currentPage() === $index + 1">
              <button class="page-link" (click)="goToPage($index + 1)">
                {{ $index + 1 }}
              </button>
            </li>
            }
            <li
              class="page-item"
              [class.disabled]="currentPage() === totalPages()"
            >
              <button
                class="page-link"
                (click)="nextPage()"
                [disabled]="currentPage() === totalPages()"
              >
                Next
              </button>
            </li>
          </ul>
        </nav>
      </div>
      }
    </div>
  </div>
  } @if (!isLoading() && users().length === 0) {
  <div class="alert alert-info">No users found.</div>
  }
</div>
