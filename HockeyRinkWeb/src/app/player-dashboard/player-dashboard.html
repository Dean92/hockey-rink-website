<div class="container-fluid py-4">
  <!-- Page Header -->
  <div class="mb-4">
    <h2 class="fw-bold mb-1">My Team Assignments</h2>
    <div class="text-muted">View your team roster and upcoming sessions</div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <div
    class="d-flex flex-column align-items-center justify-content-center py-5"
  >
    <div class="spinner-border text-primary mb-3" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <div class="text-muted">Loading your teams...</div>
  </div>
  }

  <!-- Error State -->
  @if (errorMessage()) {
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    {{ errorMessage() }}
    <button
      type="button"
      class="btn-close"
      (click)="errorMessage.set(null)"
    ></button>
  </div>
  }

  <!-- Current Teams -->
  @if (!isLoading() && currentTeams().length > 0) {
  <div class="mb-5">
    <h4 class="fw-bold mb-3">Current Teams</h4>
    <div class="row g-3">
      @for (team of currentTeams(); track team.sessionId) {
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm team-card">
          <div
            class="card-header text-white"
            [style.background-color]="team.teamColor || '#0d6efd'"
          >
            <h5 class="mb-0">{{ team.teamName }}</h5>
            @if (team.isCaptain) {
            <span class="badge bg-warning text-dark mt-2">
              <i class="bi bi-star-fill"></i> Captain
            </span>
            }
          </div>
          <div class="card-body">
            <p class="mb-2"><strong>Session:</strong> {{ team.sessionName }}</p>
            <p class="mb-2"><strong>League:</strong> {{ team.leagueName }}</p>
            <p class="mb-2">
              <strong>Date:</strong> {{ formatDate(team.sessionDate) }}
            </p>
            @if (team.sessionRecord) {
            <p class="mb-2">
              <strong>Record:</strong> {{ team.sessionRecord }}
            </p>
            } @if (team.standing) {
            <p class="mb-0"><strong>Standing:</strong> {{ team.standing }}</p>
            }
          </div>
          <div class="card-footer bg-white border-top-0">
            <button
              class="btn btn-sm btn-outline-primary w-100"
              (click)="viewTeamDetails(team.sessionId)"
            >
              <i class="bi bi-people-fill me-1"></i> View Roster
            </button>
          </div>
        </div>
      </div>
      }
    </div>
  </div>
  }

  <!-- Past Teams -->
  @if (!isLoading() && pastTeams().length > 0) {
  <div class="mb-4">
    <h4 class="fw-bold mb-3">Past Teams</h4>
    <div class="row g-3">
      @for (team of pastTeams(); track team.sessionId) {
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm team-card opacity-75">
          <div
            class="card-header text-white"
            [style.background-color]="team.teamColor || '#6c757d'"
          >
            <h5 class="mb-0">{{ team.teamName }}</h5>
            @if (team.isCaptain) {
            <span class="badge bg-warning text-dark mt-2">
              <i class="bi bi-star-fill"></i> Captain
            </span>
            }
          </div>
          <div class="card-body">
            <p class="mb-2"><strong>Session:</strong> {{ team.sessionName }}</p>
            <p class="mb-2"><strong>League:</strong> {{ team.leagueName }}</p>
            <p class="mb-2">
              <strong>Date:</strong> {{ formatDate(team.sessionDate) }}
            </p>
            @if (team.sessionRecord) {
            <p class="mb-2">
              <strong>Record:</strong> {{ team.sessionRecord }}
            </p>
            } @if (team.standing) {
            <p class="mb-0"><strong>Standing:</strong> {{ team.standing }}</p>
            }
          </div>
          <div class="card-footer bg-white border-top-0">
            <button
              class="btn btn-sm btn-outline-secondary w-100"
              (click)="viewTeamDetails(team.sessionId)"
            >
              <i class="bi bi-people-fill me-1"></i> View Roster
            </button>
          </div>
        </div>
      </div>
      }
    </div>
  </div>
  }

  <!-- Empty State -->
  @if (!isLoading() && teams().length === 0 && !errorMessage()) {
  <div class="text-center py-5">
    <i class="bi bi-inbox display-1 text-muted"></i>
    <h4 class="mt-3 text-muted">No Team Assignments Yet</h4>
    <p class="text-muted">
      You haven't been assigned to any teams. Check back after registration
      closes and teams are drafted.
    </p>
  </div>
  }
</div>

<!-- Team Details Modal -->
@if (showTeamModal()) {
<div
  class="modal fade show d-block"
  tabindex="-1"
  style="background-color: rgba(0, 0, 0, 0.5)"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Team Roster</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeTeamModal()"
        ></button>
      </div>
      <div class="modal-body">
        @if (loadingTeamDetails()) {
        <div class="text-center py-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
        } @else if (selectedTeam()) {
        <div>
          <div class="mb-3">
            <h4
              class="text-white p-3 rounded"
              [style.background-color]="selectedTeam()!.teamColor || '#0d6efd'"
            >
              {{ selectedTeam()!.teamName }}
            </h4>
            <p class="mb-1">
              <strong>Captain:</strong> {{ selectedTeam()!.captainName }}
            </p>
            <p class="mb-1">
              <strong>Session:</strong> {{ selectedTeam()!.sessionName }}
            </p>
            <p class="mb-1">
              <strong>League:</strong> {{ selectedTeam()!.leagueName || "N/A" }}
            </p>
            <p class="mb-0">
              <strong>Date:</strong>
              {{ formatDate(selectedTeam()!.sessionDate) }}
            </p>
          </div>

          <h5 class="fw-bold mb-3">Roster</h5>
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Position</th>
                  @if (selectedTeam()!.isCaptain) {
                  <th>Email</th>
                  }
                </tr>
              </thead>
              <tbody>
                @for (player of selectedTeam()!.teammates; track player.name) {
                <tr>
                  <td>{{ player.name }}</td>
                  <td>{{ player.position }}</td>
                  @if (selectedTeam()!.isCaptain) {
                  <td>{{ player.email || "N/A" }}</td>
                  }
                </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
        }
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="closeTeamModal()"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>
}
