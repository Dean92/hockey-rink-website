<div class="container mt-5 mb-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-primary mb-0">
      <i class="bi bi-speedometer2 me-2"></i>My Dashboard
    </h2>
    <a routerLink="/sessions" class="btn btn-primary">
      <i class="bi bi-plus-circle me-1"></i>Register for Session
    </a>
  </div>

  @if (isLoading()) {
  <div class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading your sessions...</p>
  </div>
  } @if (errorMessage()) {
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ errorMessage() }}
    <button
      type="button"
      class="btn-close"
      (click)="errorMessage.set(null)"
    ></button>
  </div>
  } @if (!isLoading()) {

  <!-- Upcoming Sessions -->
  <div class="mb-4">
    <h4 class="mb-3">
      <i class="bi bi-calendar-check text-success me-2"></i>Upcoming Sessions
    </h4>

    @if (upcomingSessions().length === 0) {
    <div class="card shadow-sm">
      <div class="card-body text-center py-5">
        <i class="bi bi-calendar-x text-muted" style="font-size: 3rem"></i>
        <p class="text-muted mt-3 mb-3">
          You don't have any upcoming sessions.
        </p>
        <a routerLink="/sessions" class="btn btn-primary">
          <i class="bi bi-search me-1"></i>Browse Sessions
        </a>
      </div>
    </div>
    } @else {
    <div class="row g-3">
      @for (session of upcomingSessions(); track session.sessionId) {
      <div class="col-md-6">
        <div class="card shadow-sm h-100 session-card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h5 class="card-title mb-0">{{ session.sessionName }}</h5>
              <span class="badge bg-success">Active</span>
            </div>

            <p class="text-muted mb-3">
              <i class="bi bi-trophy me-1"></i>{{ session.leagueName }}
            </p>

            <div class="session-details">
              <p class="mb-2">
                <i class="bi bi-calendar-event text-primary me-2"></i>
                <strong>Start:</strong>
                {{ session.startDate | date : "MMMM d, y 'at' h:mm a" }}
              </p>
              <p class="mb-2">
                <i class="bi bi-calendar-check text-primary me-2"></i>
                <strong>End:</strong>
                {{ session.endDate | date : "MMMM d, y 'at' h:mm a" }}
              </p>
              <p class="mb-2">
                <i class="bi bi-cash text-success me-2"></i>
                <strong>Amount Paid:</strong> ${{ session.amountPaid }}
              </p>
              <p class="mb-2">
                <i class="bi bi-person-badge text-info me-2"></i>
                <strong>Position:</strong>
                {{ session.position || "Not specified" }}
              </p>
              <p class="mb-0 text-muted small">
                <i class="bi bi-clock me-1"></i>Registered:
                {{ session.registrationDate | date : "short" }}
              </p>
            </div>
          </div>
        </div>
      </div>
      }
    </div>
    }
  </div>

  <!-- Current Sessions -->
  <div class="mb-4">
    <h4 class="mb-3">
      <i class="bi bi-play-circle text-primary me-2"></i>Current Sessions
    </h4>

    @if (currentSessions().length === 0) {
    <div class="card shadow-sm">
      <div class="card-body text-center py-4">
        <p class="text-muted mb-0">No current sessions in progress.</p>
      </div>
    </div>
    } @else {
    <div class="row g-3">
      @for (session of currentSessions(); track session.sessionId) {
      <div class="col-md-6">
        <div class="card shadow-sm h-100 session-card border-primary">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h5 class="card-title mb-0">{{ session.sessionName }}</h5>
              <span class="badge bg-primary">In Progress</span>
            </div>

            <p class="text-muted mb-3">
              <i class="bi bi-trophy me-1"></i>{{ session.leagueName }}
            </p>

            <div class="session-details">
              <p class="mb-2">
                <i class="bi bi-calendar-event text-primary me-2"></i>
                <strong>Start:</strong>
                {{ session.startDate | date : "MMMM d, y 'at' h:mm a" }}
              </p>
              <p class="mb-2">
                <i class="bi bi-calendar-check text-primary me-2"></i>
                <strong>End:</strong>
                {{ session.endDate | date : "MMMM d, y 'at' h:mm a" }}
              </p>
              <p class="mb-2">
                <i class="bi bi-cash text-success me-2"></i>
                <strong>Amount Paid:</strong> ${{ session.amountPaid }}
              </p>
              <p class="mb-2">
                <i class="bi bi-person-badge text-info me-2"></i>
                <strong>Position:</strong>
                {{ session.position || "Not specified" }}
              </p>
              <p class="mb-0 text-muted small">
                <i class="bi bi-clock me-1"></i>Registered:
                {{ session.registrationDate | date : "short" }}
              </p>
            </div>
          </div>
        </div>
      </div>
      }
    </div>
    }
  </div>

  <!-- Past Sessions -->
  <div class="mb-4">
    <h4 class="mb-3">
      <i class="bi bi-clock-history text-secondary me-2"></i>Past Sessions
    </h4>

    @if (pastSessions().length === 0) {
    <div class="card shadow-sm">
      <div class="card-body text-center py-4">
        <p class="text-muted mb-0">No past sessions to display.</p>
      </div>
    </div>
    } @else {
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>Session</th>
                <th>League</th>
                <th>Date</th>
                <th>Position</th>
                <th class="text-end">Amount Paid</th>
              </tr>
            </thead>
            <tbody>
              @for (session of pastSessions(); track session.sessionId) {
              <tr>
                <td>
                  <strong>{{ session.sessionName }}</strong>
                </td>
                <td>{{ session.leagueName }}</td>
                <td>{{ session.startDate | date : "MMM d, y" }}</td>
                <td>
                  <span class="badge bg-light text-dark">{{
                    session.position || "N/A"
                  }}</span>
                </td>
                <td class="text-end">${{ session.amountPaid }}</td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Quick Actions -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title mb-3">
        <i class="bi bi-lightning-fill text-warning me-2"></i>Quick Actions
      </h5>
      <div class="d-flex gap-2 flex-wrap">
        <a routerLink="/sessions" class="btn btn-outline-primary">
          <i class="bi bi-search me-1"></i>Browse Sessions
        </a>
        <a routerLink="/leagues" class="btn btn-outline-primary">
          <i class="bi bi-trophy me-1"></i>View Leagues
        </a>
        <a routerLink="/profile" class="btn btn-outline-primary">
          <i class="bi bi-person-circle me-1"></i>Edit Profile
        </a>
      </div>
    </div>
  </div>
  }
</div>
